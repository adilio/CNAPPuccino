server {
    listen 8080 default_server;
    listen 8443 ssl default_server;
    
    # Vulnerable SSL configuration (should trigger CSPM alerts)
    ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers 'ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv3:+EXP';
    ssl_prefer_server_ciphers off;
    
    ssl_certificate /etc/nginx/ssl/nginx.crt;
    ssl_certificate_key /etc/nginx/ssl/nginx.key;
    
    root /var/www/html;
    index index.html index.php;
    
    # Enable directory listing (insecure)
    location / {
        autoindex on;
        autoindex_exact_size off;
        autoindex_localtime on;
        try_files $uri $uri/ =404;
    }
    
    # Expose secret directory with directory listing
    location /secret {
        alias /opt/cnappuccino/secret/;
        autoindex on;
        autoindex_exact_size off;
    }
    
    # PHP processing (handle both PHP5 and PHP7)
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        # Try PHP5-FPM first, fallback to PHP7-FPM
        fastcgi_pass unix:/var/run/php5-fpm.sock;
        fastcgi_intercept_errors on;
        error_page 502 = @php7;
    }
    
    location @php7 {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/run/php/php7.0-fpm.sock;
    }
    
    # Disable security headers (should trigger alerts)
    add_header X-Frame-Options "";
    add_header X-Content-Type-Options "";
    add_header X-XSS-Protection "";
}